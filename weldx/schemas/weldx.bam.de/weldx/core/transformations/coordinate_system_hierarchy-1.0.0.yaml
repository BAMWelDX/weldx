%YAML 1.1
---
$schema: "http://stsci.edu/schemas/yaml-schema/draft-01"
id: "asdf://weldx.bam.de/weldx/schemas/core/transformations/coordinate_system_hierarchy-1.0.0"

title: |
  Schema that describes a local coordinate system hierarchy
description: |
  It stores information how the different coordinate systems are arranged towards each other. The basic data structure
  is a tree.
type: object


definitions:
  coordinate_system_node:
    allOf:
      - oneOf:
          - tag: "asdf://weldx.bam.de/weldx/tags/core/graph/di_node-1.0.0"
      - type: object
        properties:
          attributes:
            type: object
            properties:
              data:
                type: object
                anyOf:
                  - wx_property_tag: "asdf://weldx.bam.de/weldx/tags/core/data_array-1.0.0"
                  - wx_property_tag: "asdf://weldx.bam.de/weldx/tags/core/geometry/spatial_data-1.0.0"

          edges:
            type: array
            items:
              $ref: "#/definitions/coordinate_transformation_edge"
        required: [ attributes ]

  coordinate_transformation_edge:
    allOf:
    - oneOf:
      - tag: "asdf://weldx.bam.de/weldx/tags/core/graph/di_edge-1.0.0"
    - type: object
      properties:
        attributes:
          type: object
          properties:
            lcs:
              tag: "asdf://weldx.bam.de/weldx/tags/core/transformations/local_coordinate_system-1.*"
          required: [lcs]
        target_node:
          $ref: "#/definitions/coordinate_system_node"
      required: [attributes]

  subsystem_data:
    type: array
    items:
      type: object
      properties:
        name:
          type: string
        reference_time:
          tag: "asdf://weldx.bam.de/weldx/tags/time/timestamp-1.*"
        common_node:
          type: string
        root_node:
          type: string
        members:
          type: array
          items:
            type: string
        data:
          type: array
          items:
            type: string
        subsystems:
          $ref: "#/definitions/subsystem_data"



properties:
  name:
    type: string

  reference_time:
    oneOf:
      - tag: "asdf://weldx.bam.de/weldx/tags/time/timestamp-1.*"

  graph:
    allOf:
      - tag: "asdf://weldx.bam.de/weldx/tags/core/graph/di_graph-1.0.0"
      - type: object
        properties:
          root_node:
            $ref: "#/definitions/coordinate_system_node"

  subsystems:
    $ref: "#/definitions/subsystem_data"

propertyOrder: [name, reference_time, graph]
required: [name]
flowStyle: block
...
