%YAML 1.1
---
$schema: "http://stsci.edu/schemas/yaml-schema/draft-01"
id: "http://weldx.bam.de/schemas/weldx/measurement/measurement_chain-1.0.0"
tag: "tag:weldx.bam.de:weldx/measurement/measurement_chain-1.0.0"

title: |
  Schema that describes a measurement_chain
description: |
  A measurement chain describes the different steps that are performed to acquire experimental data. It collects all
  relevant information about the initial source signal and the involved transformations. In this schema, the fundamental
  data representation of the measurement chain is a directed graph with the signals being the nodes and the
  transformations being the edges.

example:
  -
    - |
      A measurement chain representing a current measurement. It consists of 2 transformations, an AD conversion and
      subsequent application of the calibration data.
    - |
      !<tag:weldx.bam.de:weldx/measurement/measurement_chain-1.0.0>
        name: Welding current measurement chain
        data_source: !<tag:weldx.bam.de:weldx/measurement/source-1.0.0>
          name: Current sensor
          output_signal: &id001 !<tag:weldx.bam.de:weldx/measurement/signal-1.0.0>
            signal_type: analog
            unit: V
          error: !<tag:weldx.bam.de:weldx/measurement/error-1.0.0>
            deviation: !unit/quantity-1.1.0 {unit: percent, value: 0.2}
        graph: !<tag:weldx.bam.de:weldx/core/graph/di_graph-1.0.0>
          root_node: !<tag:weldx.bam.de:weldx/core/graph/di_node-1.0.0>
            name: Current sensor
            attributes:
              signal: *id001
            edges:
            - !<tag:weldx.bam.de:weldx/core/graph/di_edge-1.0.0>
              direction: fwd
              attributes:
                transformation: !<tag:weldx.bam.de:weldx/measurement/signal_transformation-1.0.0>
                  name: AD conversion
                  error: !<tag:weldx.bam.de:weldx/measurement/error-1.0.0>
                    deviation: !unit/quantity-1.1.0 {unit: percent, value: 0.025}
                  func: !<tag:weldx.bam.de:weldx/core/mathematical_expression-1.0.0>
                    expression: a*x
                    parameters:
                      a: !unit/quantity-1.1.0 {unit: 1 / volt, value: 1}
                  type_transformation: AD
              target_node: !<tag:weldx.bam.de:weldx/core/graph/di_node-1.0.0>
                name: AD conversion
                attributes:
                  signal: !<tag:weldx.bam.de:weldx/measurement/signal-1.0.0>
                    signal_type: digital
                    unit: dimensionless
                edges:
                - !<tag:weldx.bam.de:weldx/core/graph/di_edge-1.0.0>
                  direction: fwd
                  attributes:
                    transformation: !<tag:weldx.bam.de:weldx/measurement/signal_transformation-1.0.0>
                      name: Calibration
                      error: !<tag:weldx.bam.de:weldx/measurement/error-1.0.0>
                        deviation: !unit/quantity-1.1.0 {unit: percent, value: 0.1}
                      func: !<tag:weldx.bam.de:weldx/core/mathematical_expression-1.0.0>
                        expression: a*x + b
                        parameters:
                          a: !unit/quantity-1.1.0 {unit: ampere, value: 75}
                          b: !unit/quantity-1.1.0 {unit: ampere, value: 25}
                      type_transformation: DD
                  target_node: !<tag:weldx.bam.de:weldx/core/graph/di_node-1.0.0>
                    name: Calibration
                    attributes:
                      signal: !<tag:weldx.bam.de:weldx/measurement/signal-1.0.0>
                        signal_type: digital
                        unit: ampere

definitions:
  signal_node:
    description: |
      A graph node that represents a measurement signal.
    allOf:
      - tag: "tag:weldx.bam.de:weldx/core/graph/di_node-1.0.0"
      - type: object
        properties:
          attributes:
            type: object
            properties:
              signal:
                description: |
                  The measurement signal
                tag: "tag:weldx.bam.de:weldx/measurement/signal-1.0.0"
            required: [signal]
          edges:
            type: array
            items:
              $ref: "#/definitions/signal_transform_edge"
            maxItems: 1
        required: [attributes]

  signal_transform_edge:
    description: |
      A graph edge that represents a signal transformation.
    allOf:
      - tag: "tag:weldx.bam.de:weldx/core/graph/di_edge-1.0.0"
      - type: object
        properties:
          attributes:
            type: object
            properties:
              transformation:
                description: |
                  The performed transformation.
                tag: "tag:weldx.bam.de:weldx/measurement/signal_transformation-1.0.0"
              equipment:
                description: |
                  The equipment that performs the transformation
                tag: "tag:weldx.bam.de:weldx/equipment/measurement_equipment-1.0.0"
            required: [transformation]
          target_node:
            $ref: "#/definitions/signal_node"
          direction:
            enum: [fwd]
        required: [attributes]


type: object
properties:
  name:
    description: |
      The name of the measurement chain.
    type: string

  data_source:
    description: |
      The source that generates the first signal and is the first element of the chain.
    tag: "tag:weldx.bam.de:weldx/measurement/source-1.0.0"

  graph:
    description: |
      The measurement chain depicted by a graph. Signals are represented by the nodes and transformations by the edges.
    allOf:
      - tag: "tag:weldx.bam.de:weldx/core/graph/di_graph-1.0.0"
      - type: object
        properties:
          root_node:
            $ref: "#/definitions/signal_node"

  source_equipment:
    description: |
            The equipment that produces the source signal.
    tag: "tag:weldx.bam.de:weldx/equipment/measurement_equipment-1.0.0"


propertyOrder: [name, data_source, graph, source_equipment]
required: [name, data_source, graph]
flowStyle: block
...
